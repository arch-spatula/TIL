# AoC 일찍 포기하고 플래시카드 만들기 14일차

1일1커밋 무사고: 743일차

## 감사일기

1. ???

## todo

- [ ] 플래시카드
  - [x] 단순 카드 생성
  - [ ] 단순 문제 풀이
  - [ ] api와 파일 route 분리

---

## 단위 테스트 mock 레포지토리

- 다음에 시도할 날짜를 방어해야 하는데 서비스 계층에서 방어하고자 합니다. 실제로 이런식으로 하는지 의문입니다. 유효성 검증을 더 일찍할 것 같다는 생각이 듭니다.

---

## sqlite 시간 처리

| id  | question | answer | stack | nextTry |
| --- | -------- | ------ | ----- | ------- |
| 1    |  CPU 본딧말|  central processing unit      |  3     |  2024-12-24       |
| 2    |  백엔드에서 쿼리를 처리하는 부분 분리해서 작성하는 방식 혹은 디자인 패턴?|  레파지토리 패턴|2  | 2024-12-24    |

- 위 표가 제가 만든 스키마에 해당합니다. 아직 테그 로직을 추가하지 않았습니다.
- nextTry는 다음에 풀이할 시간을 찾을 때 활용하려는 컬럼입니다. 쿼리 중 현재 시각을 지나면 선택이 되어야 합니다. 즉 비교문을 활용해야 합니다.
- https://stackoverflow.com/questions/65159187/dates-in-sqlite
  - 위를 보니까 unix timestamp를 활용해서 날짜를 저장하면 될 것 같습니다. 단점은 데이터베이스 컨트롤할 때 날짜를 식별할 때 거쳐야 하는 과정이 조금 있을 것입니다. 직관성이 떨어지는 문제가 있는 것입니다.
  - 보통 직관적인 형태는 협정시각 형식일 것입니다.
- 이런 이유로 스키마를 바꿔야 할 것 같습니다.
- 딜레마는 실제 타입과 DB 스키마가 다르다는 것입니다. sqlite는 int인데 실제 요청을 주고 받는 부분은 Date 타입을 사용해야 합니다. 이런 이유로 DTO가 따로 있는 것 같습니다. 프론트엔드와 서버 사이 통신할 때 해당 컬럼은 Date로 간주하고 DB에서 쿼리할 때는 unix timestamp로 int로 보고 쿼리해야 합니다.
- https://stackoverflow.com/questions/221294/how-do-i-get-a-timestamp-in-javascript
- https://stackoverflow.com/questions/1197928/how-to-add-30-minutes-to-a-javascript-date-object
- 다른 문제도 있습니다. int 사이즈는 8바이트입니다. unix timestamp는 32비트라고 합니다. 즉 4바이트 공간이 필요합니다. 이런 이유로 일단 사이즈 문제도 없을 것 같습니다. 다른 문제는 2038년 문제라는 것이 존재합니다. 
  - https://en.wikipedia.org/wiki/Year_2038_problem
  - 위키페이지도 있습니다. 아마 sqlite 버전 업데이트할 때 호환가능하게 마이그레이션해주면 될 것이라고 안일하게 생각하고 있습니다. 그리고 38년에 걱정해도 문제가 없지 않을까? 생각하고 있습니다. 또 이미 int가 최대 8바이트까지 호환해주기 때문에 큰 문제가 없을 것 같습니다.

### 날짜에 해당하는지 유효성 검사

- 생성하는 동안에는 특별히 할 이유가 없었습니다. 그냥 서버에서 만들면 되는 것이었습니다.
- 문제가 되는 부분은 편집할 때 인 것 같습니다. 편집하고 해당 내역을 저장할 때 날짜에 대해서 타입 유효성을 검증하는 것이 방법이 될 것 같습니다. 하지만 당장 처리하지 않겠습니다. 일단 유저의 핵심 경험은 본인이 잘 기억하고자 하는 문제를 풀어보는 것이기 때문에 그것과 관련된 비즈니스 로직을 구현하는 것이 우선인 것 같습니다.

## api를 route에 추가하기

- 페이지 요청과 api 요청을 분리하고 싶습니다. 페이지 요청은 파일 서버의 역할이 되어야 합니다.
- 이부분은 설정으로 간주하고 따로 브랜치를 만들어 해결해야 할 것 같습니다. 또 api 요청을 유틸함수로 분리해야 할 것 같습니다.
- 비즈니스로직을 처리해줄 엔드포인트 따로 만드는게 목적 입니다.
- https://stackoverflow.com/questions/50438986/how-to-create-nested-routes-with-parameters-using-nestjs
- 원래 엔드포인트는 딱 리소스만 관리하고 비즈니스 로직을 최대한 프론트엔드에서 처리하는 것이 SPA 중심 시대의 갬성이었던 것 같습니다.
- 셔플 로직을 무조건 프론트엔드에서 모든 리소스를 받아서 처리할 필요가 없다는 생각이 들어서 그렇습니다. 실제 모든 데이터와 관련된 진리는 백엔드가 갖고 있습니다. 순수하게 유저의 입력, 상호작용 상태만 관리하고 최대한 백엔드에 비즈니스 로직을 작성하고자 합니다.
- 엔드포인트 이름은 shuffle이 더 적합한 것 같습니다. 랜덤하게 서버에서 처리하고 응답을 돌려주면 됩니다. 지금 몇개 남았는지 무슨 문제 풀고 있는지 프론트로 1개만 선택해서 주면 되는 것입니다.
